<!DOCTYPE html>
<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>

            Phone Game

        </title>

        <base href="/">

        <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="./header.css" type="text/css">
        <link rel="stylesheet" type="text/css" href='./main.css'>

    </head>

    <body>

        <div class="header">

            <div class="header-cont">

                <img src="./favicon.ico" width="30px" height="30px" alt="icon" />
                <h2 class="title">Fartic Phone<sup>Â©</sup></h2>

            </div>

            <div class="header-cont">

                <button class="header-button" id="host-button">Host Game</button>
                <button class="header-button" id="join-button">Join Game</button>
                <p class="header-text">Room Code: <span id="room-num"></span></p>

            </div>

        </div>

        <div class="name-input hidden">

            <label for="name-box">Enter Username Here:</label>
            <input type="text" id="name-box" name="name-box">
            <button class="submit-button">Submit Name</button>

        </div>

        <div class="body">

            <div class="player-box">

                <h3 class="player-title">Players</h3>

                <ul id="players-box"></ul>

            </div>

            <div class="chat-box">

                <h3 class="chat-title">Chat</h3>

                <form class="hidden" id="form">

                    <input id="message-box" autocomplete="off" type="text">
                    <button id="chat-button">Send</button>

                </form>

                <ul id="messages-box"></ul>

            </div>

        </div>

        <script src="/socket.io/socket.io.js"></script>
        <script>

            let socket = io();
            let username = "";
            let roomCode;
            let form = document.getElementById("form");

            $("#host-button").on("click", () => {

                socket.emit("host game", socket.id);
                console.log(socket.id)

            });

            $("#join-button").on("click", () => {

                roomCode = parseInt(prompt("Enter the room code:"));
                socket.emit("join game", roomCode);

            });

            socket.on("connectedRoom", function(code) {

                console.log(code);
                $("#room-num").text(code);
                $(".name-input").removeClass("hidden");
                roomCode = code;

            });

            $(".submit-button").on("click", () => {

                let name = $("#name-box").val();
                socket.emit("submit name", socket.id, name, roomCode);
                $(".name-input").addClass("hidden");
                $("#form").removeClass("hidden");

            });

            form.addEventListener("submit", (e) => {

                e.preventDefault();

                if ($("#message-box").val()) {

                    socket.emit("receive message", $("#message-box").val());
                    $("#message-box").val("");

                }

            });

            socket.on("send message", (name, msg) => {

                $("#messages-box").append(`<li class='chat-message'><b>${name}:</b> ${msg}</li>`);

            });

        </script>

    </body>

</html>